# pwoogs 0.1 (alpha) manual

pwoogs is a Python wrapper for MOOG synth, an application widely used in astronomy for synthesis of spectral lines. I recently started working on this after being fed up with the usual interface and plotting of MOOG. The code is very bare at the moment, but I'll be working on improving it, adding more features and a proper documentation as time goes on. pwoogs is written for Python 2.7 and MOOG version jul2014.

Dependencies
------------

These are the required programs/packages to run pwoogs:

* Python 2.7
* MOOG silent (therefore, also superMONGO, Fortran and C compilers)
* NumPy
* Matplotlib

These other programs/packages are highly recommended:

* makekurucz2004: used to create interpolations of the atmosphere models from Castelli & Kurucz 2004. I'm looking at the availability of this program. More info in the next versions of this manual.

Installation
------------

Once you have the dependencies installed, you should declare the path of the MOOGSILENT installation to your system. One way to do this, for example, on Debian-based systems, is to open your .bashrc profile and put this line inside it:

    PATH=/whatever/path/you/installed/moogjul2014:$PATH

In order to install pwoogs, download it and run the setup:
 
    python setup.py install
    
Usage
------------

You should start your python environment inside a folder containing the following files:

* star.mod: the atmosphere model for your star. It is user-generated or generated by the program makekurucz2004 (more info about this in the next versions of this manual). Alternatively, you can use astroChasqui's q2 (https://github.com/astroChasqui/q2) program to generate it (needs to be confirmed)
* batch.par (empty file): just create it empty so moog.py can read and write it
* spectrum.dat: a 2-column file (with no header) containing the wavelengths in the first column (angstrom) and normalized intensity on the second column
* sun_syn.lin: file containing a line lists. More info about this in the next versions of the manual.
* params.txt: file containing the input parameters for MOOG, organized in a readable manner. Check the file inside the example folder. More info about this in the next versions of the manual.

Inside the python environment, pwoogs can be run using the following commands:

    from pwoogs import moog
    m = moog.run()
    
You can also run pwoogs in silent mode by setting the option silent=True when running it, like so:

    m = moog.run(silent=True)
    
Notes on SM and MOOG installation (Linux)
------------

A correct installation of SM on an Ubuntu-14.04-based Linux distribution should be done as such:

1) Untar the sm.tar file to a known location (hereafter SM source folder), preferably one which does not require superuser privileges

2) Go to the SM source folder and run set_opts

    chmod +rwx set_opts
    /.set_opts

3) When it asks for a C compiler, say "n" and set the following:

    gcc-4.8 -Wall -Dlinux -DNEED_SWAP

4) When it asks for a location for the SM files, choose 

    /usr/local

5) Once you set those options, open the /src/makefile and change XLIB11 to this option:

    XLIB11 = -L/usr/include/X11 -lX11

6) Now, open the options.h file, and change all

    FORTRAN_APPEND __

  instances to

    FORTRAN_APPEND _

  (just one underscore instead of two)
  
7) Now, go back to the previous directory and

    make
    sudo make install
    
8) Good. Now that we have SM correctly installed, it's time to setup MOOG. Download it at http://www.as.utexas.edu/~chris/MOOGJUL2014.tar.gz, untar it to a known location. We are going to install the silent version. So, open the file Moogsilent.f, and set 

    moogpath = '/whatever/path/you/installed/moogjul2014'
    machine = 'pcl'
    
9) Then, open the Makefile.rh64silent file, and set

    X11LIB = /usr/lib/gcc/x86_64-linux-gnu/4.8
    SMLIB = /opt/local/lib
    
10) Still on Makefile.rh64silent, change the lines 51 to 53 to

    MOOGSILENT:  $(OBJECTS);
	    $(FC) $(OBJECTS) -o MOOGSILENT -L$(SMLIB) -lplotsub -ldevices -lutils \
	    -L$(X11LIB) -lX11
    
11) And finally, add "Blankstring.o" and "Getsyns.o" to the list of objects (lines 5 to 22).

12) MOOG should be compile-able now. In the command line, type

    make -f Makefile.rh64silent
    
Remember to declare the MOOG path in your bash profile, and if you type MOOGSILENT on your command line, you should get MOOG running with no errors. If everything went right, pwoogs should be working well.
